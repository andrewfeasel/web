Cpu=function(){const a=0,b=1,c=2,d=3,e=4,f=5,g=6,h=7,i=8,j=9,k=11,l=12,m=13,n=14,o=15,p=0,q=1,r=2,s=3,t=0;return function(u){this.r=new Uint8Array(4),this.br=new Uint16Array(1),this.mem=u,this.reset=function(){this.r[p]=0,this.r[q]=0,this.r[r]=0,this.r[s]=253,this.br[t]=this.mem.read?this.mem.read(65532)|this.mem.read(65533)<<8:0,this.n=!1,this.v=!1,this.d=!1,this.i=!0,this.z=!1,this.c=!1,this.irqWanted=!1,this.nmiWanted=!1,this.cyclesLeft=7},this.reset(),this.saveVars=["r","br","n","v","d","i","z","c","irqWanted","nmiWanted","cyclesLeft"],this.addressingModes=[a,f,a,f,c,c,c,c,a,b,a,b,h,h,h,h,l,m,a,g,d,d,d,d,a,o,a,j,n,n,i,i,h,f,a,f,c,c,c,c,a,b,a,b,h,h,h,h,l,m,a,g,d,d,d,d,a,o,a,j,n,n,i,i,a,f,a,f,c,c,c,c,a,b,a,b,h,h,h,h,l,m,a,g,d,d,d,d,a,o,a,j,n,n,i,i,a,f,a,f,c,c,c,c,a,b,a,b,k,h,h,h,l,m,a,g,d,d,d,d,a,o,a,j,n,n,i,i,b,f,b,f,c,c,c,c,a,b,a,b,h,h,h,h,l,g,a,g,d,d,e,e,a,j,a,j,i,i,j,j,b,f,b,f,c,c,c,c,a,b,a,b,h,h,h,h,l,m,a,m,d,d,e,e,a,o,a,o,n,n,o,o,b,f,b,f,c,c,c,c,a,b,a,b,h,h,h,h,l,m,a,g,d,d,d,d,a,o,a,j,n,n,i,i,b,f,b,f,c,c,c,c,a,b,a,b,h,h,h,h,l,m,a,g,d,d,d,d,a,o,a,j,n,n,i,i],this.cycles=[7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7],this.cycle=function(){if(0===this.cyclesLeft){let b=this.mem.read(this.br[t]++),c=this.addressingModes[b];this.cyclesLeft=this.cycles[b],(this.nmiWanted||this.irqWanted&&!this.i)&&(this.br[t]--,this.nmiWanted?(this.nmiWanted=!1,b=256):b=257,c=a,this.cyclesLeft=7);let d=this.getAdr(c);this.functions[b].call(this,d,b)}this.cyclesLeft--},this.getP=function(a){let b=0;return b|=this.n?128:0,b|=this.v?64:0,b|=this.d?8:0,b|=this.i?4:0,b|=this.z?2:0,b|=this.c?1:0,b|=32,b|=a?16:0,b},this.setP=function(a){this.n=0<(128&a),this.v=0<(64&a),this.d=0<(8&a),this.i=0<(4&a),this.z=0<(2&a),this.c=0<(1&a)},this.setZandN=function(a){a&=255,this.z=0===a,this.n=127<a},this.getSigned=function(a){return 127<a?-(256-a):a},this.doBranch=function(a,b){a&&(this.cyclesLeft++,this.br[t]>>8!=this.br[t]+b>>8&&this.cyclesLeft++,this.br[t]+=b)},this.getAdr=function(p){switch(p){case a:return 0;case b:return this.br[t]++;case c:return this.mem.read(this.br[t]++);case d:{let a=this.mem.read(this.br[t]++);return 255&a+this.r[q]}case e:{let a=this.mem.read(this.br[t]++);return 255&a+this.r[r]}case f:{let a=255&this.mem.read(this.br[t]++)+this.r[q];return this.mem.read(a)|this.mem.read(255&a+1)<<8}case g:{let a=this.mem.read(this.br[t]++),b=this.mem.read(a)|this.mem.read(255&a+1)<<8;return 65535&b+this.r[r]}case m:{let a=this.mem.read(this.br[t]++),b=this.mem.read(a)|this.mem.read(255&a+1)<<8;return b>>8<b+this.r[r]>>8&&this.cyclesLeft++,65535&b+this.r[r]}case h:{let a=this.mem.read(this.br[t]++);return a|=this.mem.read(this.br[t]++)<<8,a}case i:{let a=this.mem.read(this.br[t]++);return a|=this.mem.read(this.br[t]++)<<8,65535&a+this.r[q]}case n:{let a=this.mem.read(this.br[t]++);return a|=this.mem.read(this.br[t]++)<<8,a>>8<a+this.r[q]>>8&&this.cyclesLeft++,65535&a+this.r[q]}case j:{let a=this.mem.read(this.br[t]++);return a|=this.mem.read(this.br[t]++)<<8,65535&a+this.r[r]}case o:{let a=this.mem.read(this.br[t]++);return a|=this.mem.read(this.br[t]++)<<8,a>>8<a+this.r[r]>>8&&this.cyclesLeft++,65535&a+this.r[r]}case k:{let a=this.mem.read(this.br[t]++),b=this.mem.read(this.br[t]++),c=this.mem.read(a|b<<8);return c|=this.mem.read(255&a+1|b<<8)<<8,c}case l:{let a=this.mem.read(this.br[t]++);return this.getSigned(a)}}},this.uni=function(a,b){log("unimplemented instruction "+this.mem.getByteRep(b))},this.ora=function(a){this.r[p]|=this.mem.read(a),this.setZandN(this.r[p])},this.and=function(a){this.r[p]&=this.mem.read(a),this.setZandN(this.r[p])},this.eor=function(a){this.r[p]^=this.mem.read(a),this.setZandN(this.r[p])},this.adc=function(a){let b=this.mem.read(a),c=this.r[p]+b+(this.c?1:0);this.c=255<c,this.v=(128&this.r[p])==(128&b)&&(128&b)!=(128&c),this.r[p]=c,this.setZandN(this.r[p])},this.sbc=function(a){let b=255^this.mem.read(a),c=this.r[p]+b+(this.c?1:0);this.c=255<c,this.v=(128&this.r[p])==(128&b)&&(128&b)!=(128&c),this.r[p]=c,this.setZandN(this.r[p])},this.cmp=function(a){let b=255^this.mem.read(a),c=this.r[p]+b+1;this.c=255<c,this.setZandN(255&c)},this.cpx=function(a){let b=255^this.mem.read(a),c=this.r[q]+b+1;this.c=255<c,this.setZandN(255&c)},this.cpy=function(a){let b=255^this.mem.read(a),c=this.r[r]+b+1;this.c=255<c,this.setZandN(255&c)},this.dec=function(a){let b=255&this.mem.read(a)-1;this.setZandN(b),this.mem.write(a,b)},this.dex=function(){this.r[q]--,this.setZandN(this.r[q])},this.dey=function(){this.r[r]--,this.setZandN(this.r[r])},this.inc=function(a){let b=255&this.mem.read(a)+1;this.setZandN(b),this.mem.write(a,b)},this.inx=function(){this.r[q]++,this.setZandN(this.r[q])},this.iny=function(){this.r[r]++,this.setZandN(this.r[r])},this.asla=function(){let a=this.r[p]<<1;this.c=255<a,this.setZandN(a),this.r[p]=a},this.asl=function(a){let b=this.mem.read(a)<<1;this.c=255<b,this.setZandN(b),this.mem.write(a,b)},this.rola=function(){let a=this.r[p]<<1|(this.c?1:0);this.c=255<a,this.setZandN(a),this.r[p]=a},this.rol=function(a){let b=this.mem.read(a)<<1|(this.c?1:0);this.c=255<b,this.setZandN(b),this.mem.write(a,b)},this.lsra=function(){let a=1&this.r[p],b=this.r[p]>>1;this.c=0<a,this.setZandN(b),this.r[p]=b},this.lsr=function(a){let b=this.mem.read(a),c=b>>1;this.c=0<(1&b),this.setZandN(c),this.mem.write(a,c)},this.rora=function(){let a=1&this.r[p],b=this.r[p]>>1|(this.c?1:0)<<7;this.c=0<a,this.setZandN(b),this.r[p]=b},this.ror=function(a){let b=this.mem.read(a),c=b>>1|(this.c?1:0)<<7;this.c=0<(1&b),this.setZandN(c),this.mem.write(a,c)},this.lda=function(a){this.r[p]=this.mem.read(a),this.setZandN(this.r[p])},this.sta=function(a){this.mem.write(a,this.r[p])},this.ldx=function(a){this.r[q]=this.mem.read(a),this.setZandN(this.r[q])},this.stx=function(a){this.mem.write(a,this.r[q])},this.ldy=function(a){this.r[r]=this.mem.read(a),this.setZandN(this.r[r])},this.sty=function(a){this.mem.write(a,this.r[r])},this.tax=function(){this.r[q]=this.r[p],this.setZandN(this.r[q])},this.txa=function(){this.r[p]=this.r[q],this.setZandN(this.r[p])},this.tay=function(){this.r[r]=this.r[p],this.setZandN(this.r[r])},this.tya=function(){this.r[p]=this.r[r],this.setZandN(this.r[p])},this.tsx=function(){this.r[q]=this.r[s],this.setZandN(this.r[q])},this.txs=function(){this.r[s]=this.r[q]},this.pla=function(){this.r[p]=this.mem.read(256+(255&++this.r[s])),this.setZandN(this.r[p])},this.pha=function(){this.mem.write(256+this.r[s]--,this.r[p])},this.plp=function(){this.setP(this.mem.read(256+(255&++this.r[s])))},this.php=function(){this.mem.write(256+this.r[s]--,this.getP(!0))},this.bpl=function(a){this.doBranch(!this.n,a)},this.bmi=function(a){this.doBranch(this.n,a)},this.bvc=function(a){this.doBranch(!this.v,a)},this.bvs=function(a){this.doBranch(this.v,a)},this.bcc=function(a){this.doBranch(!this.c,a)},this.bcs=function(a){this.doBranch(this.c,a)},this.bne=function(a){this.doBranch(!this.z,a)},this.beq=function(a){this.doBranch(this.z,a)},this.brk=function(){let a=65535&this.br[t]+1;this.mem.write(256+this.r[s]--,a>>8),this.mem.write(256+this.r[s]--,255&a),this.mem.write(256+this.r[s]--,this.getP(!0)),this.i=!0,this.br[t]=this.mem.read(65534)|this.mem.read(65535)<<8},this.rti=function(){this.setP(this.mem.read(256+(255&++this.r[s])));let a=this.mem.read(256+(255&++this.r[s]));a|=this.mem.read(256+(255&++this.r[s]))<<8,this.br[t]=a},this.jsr=function(a){let b=65535&this.br[t]-1;this.mem.write(256+this.r[s]--,b>>8),this.mem.write(256+this.r[s]--,255&b),this.br[t]=a},this.rts=function(){let a=this.mem.read(256+(255&++this.r[s]));a|=this.mem.read(256+(255&++this.r[s]))<<8,this.br[t]=a+1},this.jmp=function(a){this.br[t]=a},this.bit=function(a){let b=this.mem.read(a);this.n=0<(128&b),this.v=0<(64&b);let c=this.r[p]&b;this.z=0==c},this.clc=function(){this.c=!1},this.sec=function(){this.c=!0},this.cld=function(){this.d=!1},this.sed=function(){this.d=!0},this.cli=function(){this.i=!1},this.sei=function(){this.i=!0},this.clv=function(){this.v=!1},this.nop=function(){},this.irq=function(){let a=this.br[t];this.mem.write(256+this.r[s]--,a>>8),this.mem.write(256+this.r[s]--,255&a),this.mem.write(256+this.r[s]--,this.getP(!1)),this.i=!0,this.br[t]=this.mem.read(65534)|this.mem.read(65535)<<8},this.nmi=function(){let a=this.br[t];this.mem.write(256+this.r[s]--,a>>8),this.mem.write(256+this.r[s]--,255&a),this.mem.write(256+this.r[s]--,this.getP(!1)),this.i=!0,this.br[t]=this.mem.read(65530)|this.mem.read(65531)<<8},this.kil=function(){this.br[t]--},this.slo=function(a){let b=this.mem.read(a)<<1;this.c=255<b,this.mem.write(a,b),this.r[p]|=b,this.setZandN(this.r[p])},this.rla=function(a){let b=this.mem.read(a)<<1|(this.c?1:0);this.c=255<b,this.mem.write(a,b),this.r[p]&=b,this.setZandN(this.r[p])},this.sre=function(a){let b=this.mem.read(a),c=b>>1;this.c=0<(1&b),this.mem.write(a,c),this.r[p]^=c,this.setZandN(this.r[p])},this.rra=function(a){let b=this.mem.read(a),c=b>>1|(this.c?1:0)<<7;this.mem.write(a,c);let d=this.r[p]+c+(1&b);this.c=255<d,this.v=(128&this.r[p])==(128&c)&&(128&c)!=(128&d),this.r[p]=d,this.setZandN(this.r[p])},this.sax=function(a){this.mem.write(a,this.r[p]&this.r[q])},this.lax=function(a){this.r[p]=this.mem.read(a),this.r[q]=this.r[p],this.setZandN(this.r[q])},this.dcp=function(a){let b=255&this.mem.read(a)-1;this.mem.write(a,b),b^=255;let c=this.r[p]+b+1;this.c=255<c,this.setZandN(255&c)},this.isc=function(a){let b=255&this.mem.read(a)+1;this.mem.write(a,b),b^=255;let c=this.r[p]+b+(this.c?1:0);this.c=255<c,this.v=(128&this.r[p])==(128&b)&&(128&b)!=(128&c),this.r[p]=c,this.setZandN(this.r[p])},this.anc=function(a){this.r[p]&=this.mem.read(a),this.setZandN(this.r[p]),this.c=this.n},this.alr=function(a){this.r[p]&=this.mem.read(a);let b=1&this.r[p],c=this.r[p]>>1;this.c=0<b,this.setZandN(c),this.r[p]=c},this.arr=function(a){this.r[p]&=this.mem.read(a);let b=this.r[p]>>1|(this.c?1:0)<<7;this.setZandN(b),this.c=0<(64&b),this.v=0<(64&b^(32&b)<<1),this.r[p]=b},this.axs=function(a){let b=255^this.mem.read(a),c=this.r[p]&this.r[q],d=c+b+1;this.c=255<d,this.r[q]=d,this.setZandN(this.r[q])},this.functions=[this.brk,this.ora,this.kil,this.slo,this.nop,this.ora,this.asl,this.slo,this.php,this.ora,this.asla,this.anc,this.nop,this.ora,this.asl,this.slo,this.bpl,this.ora,this.kil,this.slo,this.nop,this.ora,this.asl,this.slo,this.clc,this.ora,this.nop,this.slo,this.nop,this.ora,this.asl,this.slo,this.jsr,this.and,this.kil,this.rla,this.bit,this.and,this.rol,this.rla,this.plp,this.and,this.rola,this.anc,this.bit,this.and,this.rol,this.rla,this.bmi,this.and,this.kil,this.rla,this.nop,this.and,this.rol,this.rla,this.sec,this.and,this.nop,this.rla,this.nop,this.and,this.rol,this.rla,this.rti,this.eor,this.kil,this.sre,this.nop,this.eor,this.lsr,this.sre,this.pha,this.eor,this.lsra,this.alr,this.jmp,this.eor,this.lsr,this.sre,this.bvc,this.eor,this.kil,this.sre,this.nop,this.eor,this.lsr,this.sre,this.cli,this.eor,this.nop,this.sre,this.nop,this.eor,this.lsr,this.sre,this.rts,this.adc,this.kil,this.rra,this.nop,this.adc,this.ror,this.rra,this.pla,this.adc,this.rora,this.arr,this.jmp,this.adc,this.ror,this.rra,this.bvs,this.adc,this.kil,this.rra,this.nop,this.adc,this.ror,this.rra,this.sei,this.adc,this.nop,this.rra,this.nop,this.adc,this.ror,this.rra,this.nop,this.sta,this.nop,this.sax,this.sty,this.sta,this.stx,this.sax,this.dey,this.nop,this.txa,this.uni,this.sty,this.sta,this.stx,this.sax,this.bcc,this.sta,this.kil,this.uni,this.sty,this.sta,this.stx,this.sax,this.tya,this.sta,this.txs,this.uni,this.uni,this.sta,this.uni,this.uni,this.ldy,this.lda,this.ldx,this.lax,this.ldy,this.lda,this.ldx,this.lax,this.tay,this.lda,this.tax,this.uni,this.ldy,this.lda,this.ldx,this.lax,this.bcs,this.lda,this.kil,this.lax,this.ldy,this.lda,this.ldx,this.lax,this.clv,this.lda,this.tsx,this.uni,this.ldy,this.lda,this.ldx,this.lax,this.cpy,this.cmp,this.nop,this.dcp,this.cpy,this.cmp,this.dec,this.dcp,this.iny,this.cmp,this.dex,this.axs,this.cpy,this.cmp,this.dec,this.dcp,this.bne,this.cmp,this.kil,this.dcp,this.nop,this.cmp,this.dec,this.dcp,this.cld,this.cmp,this.nop,this.dcp,this.nop,this.cmp,this.dec,this.dcp,this.cpx,this.sbc,this.nop,this.isc,this.cpx,this.sbc,this.inc,this.isc,this.inx,this.sbc,this.nop,this.sbc,this.cpx,this.sbc,this.inc,this.isc,this.beq,this.sbc,this.kil,this.isc,this.nop,this.sbc,this.inc,this.isc,this.sed,this.sbc,this.nop,this.isc,this.nop,this.sbc,this.inc,this.isc,this.nmi,this.irq]}}();