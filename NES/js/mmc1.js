mappers[1]=function(a,b,c){this.name="MMC1",this.version=1,this.nes=a,this.rom=b,this.h=c,this.chrRam=new Uint8Array(8192),this.prgRam=new Uint8Array(8192),this.ppuRam=new Uint8Array(2048),this.reset=function(a){if(a){for(let a=0;a<this.chrRam.length;a++)this.chrRam[a]=0;if(!this.h.battery)for(let a=0;a<this.prgRam.length;a++)this.prgRam[a]=0;for(let a=0;a<this.ppuRam.length;a++)this.ppuRam[a]=0}this.shiftReg=0,this.shiftCount=0,this.mirroring=0,this.prgMode=3,this.chrMode=1,this.chrBank0=0,this.chrBank1=0,this.prgBank=0,this.ramEnable=0},this.reset(!0),this.saveVars=["name","chrRam","prgRam","ppuRam","shiftReg","shiftCount","mirroring","prgMode","chrMode","chrBank0","chrBank1","prgBank","ramEnable"],this.getBattery=function(){return Array.prototype.slice.call(this.prgRam)},this.setBattery=function(a){return!(8192!==a.length)&&(this.prgRam=new Uint8Array(a),!0)},this.getRomAdr=function(a){let b=0;switch(this.prgMode){case 0:case 1:{b=32768*(this.prgBank>>1)+(32767&a);break}case 2:{b=49152>a?16383&a:16384*this.prgBank+(16383&a);break}case 3:{b=49152>a?16384*this.prgBank+(16383&a):16384*(this.h.banks-1)+(16383&a);break}}return b&this.h.prgAnd},this.getMirroringAdr=function(a){switch(this.mirroring){case 0:return 1023&a;case 1:return 1024+(1023&a);case 2:return 2047&a;case 3:return 1023&a|(2048&a)>>1;}},this.getChrAdr=function(a){let b=0;return b=1===this.chrMode?4096>a?4096*this.chrBank0+(4095&a):4096*this.chrBank1+(4095&a):8192*(this.chrBank0>>1)+(8191&a),b&this.h.chrAnd},this.peak=function(a){return this.read(a)},this.read=function(a){return 24576>a?0:32768>a?1===this.ramEnable?0:this.prgRam[8191&a]:this.rom[this.h.base+this.getRomAdr(a)]},this.write=function(a,b){if(!(24576>a)){if(32768>a)return 1===this.ramEnable?void 0:void(this.prgRam[8191&a]=b);if(0<(128&b))this.shiftCount=0,this.shiftReg=0;else if(this.shiftReg|=(1&b)<<this.shiftCount,this.shiftCount++,5===this.shiftCount){switch((24576&a)>>13){case 0:{this.mirroring=3&this.shiftReg,this.prgMode=(12&this.shiftReg)>>2,this.chrMode=(16&this.shiftReg)>>4;break}case 1:{this.chrBank0=this.shiftReg;break}case 2:{this.chrBank1=this.shiftReg;break}case 3:{this.prgBank=15&this.shiftReg,this.ramEnable=(16&this.shiftReg)>>4;break}}this.shiftCount=0,this.shiftReg=0}}},this.ppuPeak=function(a){return this.ppuRead(a)},this.ppuRead=function(a){return 8192>a?0===this.h.chrBanks?this.chrRam[this.getChrAdr(a)]:this.rom[this.h.chrBase+this.getChrAdr(a)]:this.ppuRam[this.getMirroringAdr(a)]},this.ppuWrite=function(a,b){return 8192>a?0===this.h.chrBanks?void(this.chrRam[this.getChrAdr(a)]=b):void 0:this.ppuRam[this.getMirroringAdr(a)]=b}};